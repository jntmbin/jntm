<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒœç”»æ¸¸æˆ - æˆ‘ç”»AIçŒœ</title>
    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <!-- MobileNet Model -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 0.9em;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            align-items: center;
        }

        .tool-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-group label {
            font-weight: bold;
            color: #555;
            font-size: 0.9em;
        }

        .color-btn {
            width: 35px;
            height: 35px;
            border: 3px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-btn:hover {
            transform: scale(1.1);
            border-color: #999;
        }

        .color-btn.active {
            border-color: #333;
            border-width: 4px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-clear {
            background: #ff6b6b;
            color: white;
        }

        .btn-clear:hover {
            background: #ee5a52;
            transform: translateY(-2px);
        }

        .btn-eraser {
            background: #95a5a6;
            color: white;
        }

        .btn-eraser:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .btn-eraser.active {
            background: #34495e;
        }

        .btn-guess {
            background: #4CAF50;
            color: white;
            font-size: 1.1em;
            padding: 12px 30px;
        }

        .btn-guess:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-guess:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        input[type="range"] {
            width: 100px;
            cursor: pointer;
        }

        .canvas-container {
            border: 3px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            background: white;
            display: flex;
            justify-content: center;
        }

        canvas {
            display: block;
            cursor: crosshair;
            background: white;
        }

        .actions {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .result {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            min-height: 100px;
            display: none;
        }

        .result.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .guess-list {
            list-style: none;
        }

        .guess-item {
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .guess-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .guess-item .confidence {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .thinking {
            text-align: center;
            color: #667eea;
            font-style: italic;
            padding: 20px;
        }

        .thinking::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ çŒœç”»æ¸¸æˆ</h1>
        <p class="subtitle">ä½ æ¥ç”»ï¼ŒAIæ¥çŒœï¼ä½¿ç”¨ TensorFlow.js MobileNet æ·±åº¦å­¦ä¹ æ¨¡å‹è¯†åˆ«</p>
        <p class="subtitle" id="modelStatus" style="color: #ff6b6b; font-weight: bold;">ğŸ”„ AIæ¨¡å‹åŠ è½½ä¸­...</p>

        <div class="toolbar">
            <div class="tool-group">
                <label>é¢œè‰²:</label>
                <div class="color-btn active" data-color="#000000" style="background: #000000;" title="é»‘è‰²"></div>
                <div class="color-btn" data-color="#ff0000" style="background: #ff0000;" title="çº¢è‰²"></div>
                <div class="color-btn" data-color="#00ff00" style="background: #00ff00;" title="ç»¿è‰²"></div>
                <div class="color-btn" data-color="#0000ff" style="background: #0000ff;" title="è“è‰²"></div>
                <div class="color-btn" data-color="#ffff00" style="background: #ffff00;" title="é»„è‰²"></div>
                <div class="color-btn" data-color="#ff00ff" style="background: #ff00ff;" title="ç´«è‰²"></div>
                <div class="color-btn" data-color="#00ffff" style="background: #00ffff;" title="é’è‰²"></div>
                <div class="color-btn" data-color="#ffa500" style="background: #ffa500;" title="æ©™è‰²"></div>
            </div>

            <div class="tool-group">
                <label>ç²—ç»†:</label>
                <input type="range" id="brushSize" min="1" max="20" value="3">
                <span id="sizeDisplay">3px</span>
            </div>

            <div class="tool-group">
                <button class="btn-eraser" id="eraserBtn">æ©¡çš®æ“¦</button>
                <button class="btn-clear" id="clearBtn">æ¸…ç©ºç”»å¸ƒ</button>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="canvas" width="800" height="500"></canvas>
        </div>

        <div class="actions">
            <button class="btn-guess" id="guessBtn" disabled>ğŸ¤– è®©AIçŒœçŒœçœ‹</button>
        </div>

        <div class="result" id="result">
            <div class="thinking" id="thinking">AIæ­£åœ¨æ€è€ƒ</div>
            <div id="guessContent" style="display: none;">
                <h2>ğŸ¯ AIçš„çŒœæµ‹ç»“æœï¼š</h2>
                <ul class="guess-list" id="guessList"></ul>
            </div>
        </div>
    </div>

    <script>
        // Canvas setup
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let currentColor = '#000000';
        let brushSize = 3;
        let isEraser = false;
        let model = null; // TensorFlow.js model

        // Initialize canvas
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        // Load MobileNet model
        async function loadModel() {
            const statusEl = document.getElementById('modelStatus');
            const guessBtn = document.getElementById('guessBtn');

            try {
                statusEl.textContent = 'ğŸ”„ AIæ¨¡å‹åŠ è½½ä¸­...';
                statusEl.style.color = '#ff6b6b';

                model = await mobilenet.load();

                statusEl.textContent = 'âœ… AIæ¨¡å‹åŠ è½½æˆåŠŸï¼å¯ä»¥å¼€å§‹ç”»ç”»äº†';
                statusEl.style.color = '#4CAF50';
                guessBtn.disabled = false;

                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            } catch (error) {
                statusEl.textContent = 'âŒ AIæ¨¡å‹åŠ è½½å¤±è´¥: ' + error.message;
                statusEl.style.color = '#ff0000';
                console.error('Model loading error:', error);
            }
        }

        // Load model on page load
        window.addEventListener('load', loadModel);

        // Color selection
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentColor = this.dataset.color;
                isEraser = false;
                document.getElementById('eraserBtn').classList.remove('active');
            });
        });

        // Brush size
        const brushSizeInput = document.getElementById('brushSize');
        const sizeDisplay = document.getElementById('sizeDisplay');
        brushSizeInput.addEventListener('input', function() {
            brushSize = this.value;
            sizeDisplay.textContent = brushSize + 'px';
        });

        // Eraser
        document.getElementById('eraserBtn').addEventListener('click', function() {
            isEraser = !isEraser;
            this.classList.toggle('active');
            if (isEraser) {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            }
        });

        // Clear canvas
        document.getElementById('clearBtn').addEventListener('click', function() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºç”»å¸ƒå—ï¼Ÿ')) {
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                document.getElementById('result').classList.remove('show');
            }
        });

        // Drawing functions
        function startDrawing(e) {
            isDrawing = true;
            draw(e);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        function draw(e) {
            if (!isDrawing) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            ctx.lineWidth = brushSize;
            ctx.strokeStyle = isEraser ? 'white' : currentColor;

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        // Mouse events
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch events for mobile
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            canvas.dispatchEvent(mouseEvent);
        });

        // AI Guessing Logic
        document.getElementById('guessBtn').addEventListener('click', async function() {
            if (!model) {
                alert('AIæ¨¡å‹æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                return;
            }

            const resultDiv = document.getElementById('result');
            const thinkingDiv = document.getElementById('thinking');
            const guessContent = document.getElementById('guessContent');

            resultDiv.classList.add('show');
            thinkingDiv.style.display = 'block';
            guessContent.style.display = 'none';

            try {
                // Use real AI to analyze the drawing
                const guesses = await analyzeDrawingWithAI();
                displayGuesses(guesses);
                thinkingDiv.style.display = 'none';
                guessContent.style.display = 'block';
            } catch (error) {
                thinkingDiv.textContent = 'âŒ AIè¯†åˆ«å¤±è´¥: ' + error.message;
                console.error('Prediction error:', error);
            }
        });

        async function analyzeDrawingWithAI() {
            // Create a temporary image element from canvas
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

            // Create a temporary canvas to resize the image (MobileNet expects smaller images)
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 224;
            tempCanvas.height = 224;
            const tempCtx = tempCanvas.getContext('2d');

            // Draw the current canvas onto the temp canvas (resized)
            tempCtx.drawImage(canvas, 0, 0, 224, 224);

            // Get predictions from MobileNet
            const predictions = await model.classify(tempCanvas);

            // Translate English predictions to Chinese and format them
            const guesses = predictions.map((pred, index) => {
                const translatedName = translatePrediction(pred.className);
                const confidence = Math.round(pred.probability * 100);

                return {
                    name: translatedName,
                    originalName: pred.className,
                    confidence: confidence,
                    reason: `AIç¥ç»ç½‘ç»œè¯†åˆ« (MobileNet)`
                };
            });

            return guesses;
        }

        // Translate common predictions to Chinese
        function translatePrediction(englishName) {
            const translations = {
                // Animals
                'cat': 'çŒ«',
                'dog': 'ç‹—',
                'bird': 'é¸Ÿ',
                'fish': 'é±¼',
                'horse': 'é©¬',
                'sheep': 'ç¾Š',
                'cow': 'ç‰›',
                'elephant': 'å¤§è±¡',
                'bear': 'ç†Š',
                'zebra': 'æ–‘é©¬',
                'giraffe': 'é•¿é¢ˆé¹¿',

                // Objects
                'car': 'æ±½è½¦',
                'bicycle': 'è‡ªè¡Œè½¦',
                'airplane': 'é£æœº',
                'boat': 'èˆ¹',
                'train': 'ç«è½¦',
                'truck': 'å¡è½¦',
                'bus': 'å…¬äº¤è½¦',

                // Food
                'apple': 'è‹¹æœ',
                'banana': 'é¦™è•‰',
                'orange': 'æ©™å­',
                'pizza': 'æŠ«è¨',
                'cake': 'è›‹ç³•',
                'bread': 'é¢åŒ…',

                // Household
                'chair': 'æ¤…å­',
                'table': 'æ¡Œå­',
                'cup': 'æ¯å­',
                'bottle': 'ç“¶å­',
                'book': 'ä¹¦',
                'clock': 'æ—¶é’Ÿ',
                'vase': 'èŠ±ç“¶',
                'lamp': 'ç¯',

                // Nature
                'tree': 'æ ‘',
                'flower': 'èŠ±',
                'sun': 'å¤ªé˜³',
                'moon': 'æœˆäº®',
                'star': 'æ˜Ÿæ˜Ÿ',
                'cloud': 'äº‘',

                // Common objects
                'pencil': 'é“…ç¬”',
                'pen': 'é’¢ç¬”',
                'umbrella': 'é›¨ä¼',
                'bag': 'åŒ…',
                'shoe': 'é‹å­',
                'hat': 'å¸½å­',
                'glasses': 'çœ¼é•œ',

                // Electronics
                'computer': 'ç”µè„‘',
                'phone': 'æ‰‹æœº',
                'camera': 'ç›¸æœº',
                'television': 'ç”µè§†',

                // Sports
                'ball': 'çƒ',
                'tennis': 'ç½‘çƒ',
                'basketball': 'ç¯®çƒ',
                'football': 'è¶³çƒ',

                // Buildings
                'house': 'æˆ¿å­',
                'building': 'å»ºç­‘',
                'bridge': 'æ¡¥',
                'tower': 'å¡”',

                // Misc
                'rainbow': 'å½©è™¹',
                'heart': 'å¿ƒå½¢',
                'face': 'è„¸',
                'smile': 'ç¬‘è„¸',
                'wheel': 'è½®å­',
                'window': 'çª—æˆ·',
                'door': 'é—¨'
            };

            // Try to find translation
            const lowerName = englishName.toLowerCase();
            for (const [eng, chn] of Object.entries(translations)) {
                if (lowerName.includes(eng)) {
                    return `${chn} (${englishName})`;
                }
            }

            // If no translation found, return original with note
            return englishName;
        }

        function displayGuesses(guesses) {
            const guessList = document.getElementById('guessList');
            guessList.innerHTML = '';

            guesses.forEach((guess, index) => {
                const li = document.createElement('li');
                li.className = 'guess-item';
                li.style.animationDelay = `${index * 0.1}s`;
                li.innerHTML = `
                    <span><strong>${index + 1}. ${guess.name}</strong> - ${guess.reason}</span>
                    <span class="confidence">${guess.confidence}%</span>
                `;
                guessList.appendChild(li);
            });
        }
    </script>
</body>
</html>
